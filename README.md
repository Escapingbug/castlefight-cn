# 城堡战争（汉化、修改）

我和几个小伙伴一直想玩城堡战争，然而现在官方对战平台上的全是莫名其妙的魔改（原版种族和新加入的种族没有可比性，完全没有游戏价值），于是想了想干脆自己处理一下。
我在 hive 上找到了原版的地图，但是看起来好像很久没有更新了，于是决定自己翻译、逆向并且按照自己理解（按照我们几个人玩的结果）修改一下。

由于本身地图并非我所制作，因此本项目没有开源协议。
希望各位尊重原作者，不要制作违背游戏价值的修改，影响城堡战争风评。

## 目录

- `changes`：修改说明文档
- `images`：图片
- `manual_translate_out`：涉及到手工的，包括手工翻译和手工修改的文件
- `map_data`: 地图的分析后数据，注意里边的数据是原地图的数据，主要做保存用（未修改，也不应当修改）
- `map`：地图二进制，包括地图原版文件和当前修改后文件
- `re`：逆向工程进度——没办法，只能逆了。
- `scripts`：自动化翻译脚本
- `translate_out`：自动化翻译结果

通过 HWM （hke W3M Modifier）分析后的 map 文件为 map_data 里的数据。翻译后重打包即可。

## 汉化字符串导入过程

### HWM 解压

![解压过程](images/unzip.png)

需要注意，默认解压位置在地图所在位置，否则需要自己设置每次重新选择（在设置里）。

### 进行翻译

调用脚本处理。见脚本运行的 [README](scripts/README.md)。

### 替换脚本

在 HWM 中将解压后的文件进行替换（同名）。

![替换过程](images/replace.png)

### 重压缩

进行重压缩，就保存了。然后就可以尝试确认有没有问题了。

## 一些坑点

1. `*strings.txt` 文件看似 ini 文件但是并非标准 ini ，section 可能重名，所以自己处理了。
2. 看似 ini 文件的 `*strings.txt` 中，等号两端不能有空格，否则无法解析。

## 修改说明

尝试性的修改：

- 获得 3 倍于基础收入之前不允许制造空中单位 [修改说明](./changes/air_unit_restriction.md)

（修改结果位于 `manual_traslate_out`）